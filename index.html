<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üß† Subjective Study Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root { --bg: #f5f6fa; --card: #ffffff; --txt: #2f3640; --prim: #5d6d7e; --sec: #3498db; --ok: #27ae60; --bad: #e67e22; }
    [data-theme="dark"] { --bg: #1a1a1a; --card: #2d2d2d; --txt: #f5f6fa; }
    body { font-family: 'Rubik', sans-serif; background: var(--bg); color: var(--txt); margin: 0; padding: 15px; transition: 0.3s; }
    .container { max-width: 600px; margin: auto; background: var(--card); padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    .main-btn { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #ddd; cursor: pointer; font-size: 16px; font-weight: 500; background: #fff; color: #333; }
    .q-card { background: var(--bg); padding: 20px; border-left: 5px solid var(--prim); border-radius: 10px; font-size: 20px; font-weight: 600; margin: 20px 0; }
    .exp-box { background: #dff9fb; padding: 15px; border-radius: 10px; display: none; margin-bottom: 15px; color: #130f40; border: 1px dashed #3498db; }
    [data-theme="dark"] .exp-box { background: #3d3d3d; color: #fff; }
    .action-btns { display: none; grid-template-columns: 1fr 1fr; gap: 10px; }
  </style>
</head>
<body>

  <div style="display:flex; justify-content: space-between; margin-bottom: 15px;">
    <button onclick="toggleTheme()" style="padding:5px 10px; border-radius:5px; border:none; background:var(--prim); color:#fff;">üåô Mode</button>
    <button id="quitBtn" onclick="location.reload()" style="display:none; background:#e74c3c; color:#fff; border:none; padding:5px 10px; border-radius:5px;">Stop</button>
  </div>

  <div class="container">
    <div id="setup">
      <h2 style="text-align:center;">üìñ Subjective Pro</h2>
      <select id="subSel" class="main-btn" onchange="updateCh()"><option value="all">-- ‡§µ‡§ø‡§∑‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç --</option></select>
      <select id="chSel" class="main-btn"><option value="all">-- ‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç --</option></select>
      <button onclick="start()" class="main-btn" style="background:var(--prim); color:#fff;">‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
    </div>

    <div id="quiz" style="display:none;">
      <div id="count" style="text-align:right; font-size:12px; opacity:0.7;"></div>
      <div id="qBox" class="q-card"></div>
      <button id="showBtn" onclick="reveal()" class="main-btn" style="background:var(--sec); color:#fff;">üëÅÔ∏è ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
      <div id="expBox" class="exp-box"></div>
      <div id="actBtns" class="action-btns">
        <button onclick="next(true)" class="main-btn" style="background:var(--ok); color:#fff;">‚úÖ ‡§∏‡§π‡•Ä ‡§•‡§æ</button>
        <button onclick="next(false)" class="main-btn" style="background:var(--bad); color:#fff;">‚ö†Ô∏è ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§ö‡§æ‡§π‡§ø‡§è</button>
      </div>
    </div>
  </div>

  <script>
    let data = {}, pool = [], idx = 0, score = 0;

    // Fetching sub.json (as seen in your GitHub)
    fetch("sub.json")
      .then(r => r.json())
      .then(j => {
        data = j;
        const s = document.getElementById("subSel");
        Object.keys(j).forEach(k => s.add(new Option(k, k)));
      })
      .catch(e => alert("Error: sub.json ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä!"));

    function updateCh() {
      const s = document.getElementById("subSel").value, c = document.getElementById("chSel");
      c.innerHTML = "<option value='all'>-- ‡§∏‡§≠‡•Ä ‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§Ø --</option>";
      if(s !== "all") Object.keys(data[s]).forEach(k => c.add(new Option(k, k)));
    }

    function start() {
      const s = document.getElementById("subSel").value, c = document.getElementById("chSel").value;
      if (s === "all") {
        Object.keys(data).forEach(sub => Object.keys(data[sub]).forEach(ch => pool = pool.concat(data[sub][ch])));
      } else if (c === "all") {
        Object.keys(data[s]).forEach(ch => pool = pool.concat(data[s][ch]));
      } else { pool = data[s][c]; }
      
      pool.sort(() => Math.random() - 0.5);
      document.getElementById("setup").style.display = "none";
      document.getElementById("quiz").style.display = "block";
      document.getElementById("quitBtn").style.display = "block";
      show();
    }

    function show() {
      document.getElementById("count").innerText = `‡§∏‡§µ‡§æ‡§≤: ${idx+1}/${pool.length}`;
      document.getElementById("qBox").innerText = pool[idx].question;
      document.getElementById("expBox").style.display = "none";
      document.getElementById("actBtns").style.display = "none";
      document.getElementById("showBtn").style.display = "block";
    }

    function reveal() {
      document.getElementById("expBox").innerText = pool[idx].explanation || "‡§ï‡•ã‡§à ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§";
      document.getElementById("expBox").style.display = "block";
      document.getElementById("showBtn").style.display = "none";
      document.getElementById("actBtns").style.display = "grid";
    }

    function next(win) {
      if(win) score++;
      idx++;
      if(idx < pool.length) show();
      else alert(`‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§ñ‡§§‡•ç‡§Æ! ‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}/${pool.length}`) || location.reload();
    }

    function toggleTheme() { document.body.setAttribute("data-theme", document.body.hasAttribute("data-theme") ? "" : "dark"); }
  </script>
</body>
</html>
