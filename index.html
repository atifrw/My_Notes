<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üß† Subjective Pro - Free Flow</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root { --bg: #f5f6fa; --card: #ffffff; --txt: #2f3640; --prim: #5d6d7e; --sec: #3498db; --ok: #27ae60; --bad: #e67e22; }
    [data-theme="dark"] { --bg: #1a1a1a; --card: #2d2d2d; --txt: #f5f6fa; }
    body { font-family: 'Rubik', sans-serif; background: var(--bg); color: var(--txt); margin: 0; padding: 15px; transition: 0.3s; }
    .container { max-width: 600px; margin: auto; background: var(--card); padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-top: 50px; }
    .main-btn { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #ddd; cursor: pointer; font-size: 16px; font-weight: 500; background: #fff; color: #333; }
    .q-card { background: var(--bg); padding: 20px; border-left: 5px solid var(--prim); border-radius: 10px; font-size: 20px; font-weight: 600; margin-bottom: 15px; }
    .exp-box { background: #dff9fb; padding: 15px; border-radius: 10px; display: none; margin-bottom: 15px; color: #130f40; border: 1px dashed #3498db; font-size: 18px; }
    [data-theme="dark"] .exp-box { background: #3d3d3d; color: #fff; }
    .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
    #quitBtn { position: fixed; top: 15px; right: 15px; background:#e74c3c; color:#fff; border:none; padding:8px 12px; border-radius:8px; display:none; cursor:pointer; z-index: 100; }
  </style>
</head>
<body>

  <button onclick="toggleTheme()" style="position:fixed; top:15px; left:15px; padding:8px 12px; border-radius:8px; border:none; background:var(--prim); color:#fff; cursor:pointer; z-index: 100;">üåô Mode</button>
  <button id="quitBtn" onclick="location.reload()">‚èπÔ∏è Stop</button>

  <div class="container">
    <div id="setup">
      <h2 style="text-align:center;">üìñ Subjective Pro</h2>
      <select id="subSel" class="main-btn" onchange="updateCh()"><option value="all">-- ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à... --</option></select>
      <select id="chSel" class="main-btn"><option value="all">-- ‡§∏‡§≠‡•Ä ‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§Ø --</option></select>
      <button onclick="start()" class="main-btn" style="background:var(--prim); color:#fff; margin-top:10px;">üöÄ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
    </div>

    <div id="quiz" style="display:none;">
      <div id="count" style="text-align:right; font-size:12px; opacity:0.7; margin-bottom:10px;"></div>
      <div id="qBox" class="q-card"></div>
      
      <button id="showBtn" onclick="toggleExp()" class="main-btn" style="background:var(--sec); color:#fff;">üëÅÔ∏è ‡§ú‡§µ‡§æ‡§¨/Explanation ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
      
      <div id="expBox" class="exp-box"></div>
      
      <div class="action-btns">
        <button onclick="next(true)" class="main-btn" style="background:var(--ok); color:#fff;">‚úÖ ‡§∏‡§π‡•Ä ‡§•‡§æ</button>
        <button onclick="next(false)" class="main-btn" style="background:var(--bad); color:#fff;">‚ö†Ô∏è ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§ö‡§æ‡§π‡§ø‡§è</button>
      </div>
    </div>
  </div>

  <script>
    let data = {}, pool = [], idx = 0, score = 0;

    fetch("sub.json")
      .then(r => r.json())
      .then(j => {
        data = j;
        const s = document.getElementById("subSel");
        s.innerHTML = "<option value='all'>-- ‡§∏‡§≠‡•Ä ‡§µ‡§ø‡§∑‡§Ø --</option>";
        Object.keys(j).forEach(k => s.add(new Option(k, k)));
      })
      .catch(e => alert("Error: sub.json ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä!"));

    function updateCh() {
      const s = document.getElementById("subSel").value, c = document.getElementById("chSel");
      c.innerHTML = "<option value='all'>-- ‡§∏‡§≠‡•Ä ‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§Ø --</option>";
      if(s !== "all") Object.keys(data[s]).forEach(k => c.add(new Option(k, k)));
    }

    function start() {
      const s = document.getElementById("subSel").value, c = document.getElementById("chSel").value;
      let temp = [];
      if (s === "all") {
        Object.keys(data).forEach(sub => Object.keys(data[sub]).forEach(ch => temp = temp.concat(data[sub][ch])));
      } else if (c === "all") {
        Object.keys(data[s]).forEach(ch => temp = temp.concat(data[s][ch]));
      } else { temp = data[s][c]; }
      
      if(temp.length === 0) return alert("‡§ï‡•ã‡§à ‡§∏‡§µ‡§æ‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ!");
      pool = [...temp].sort(() => Math.random() - 0.5);
      
      document.getElementById("setup").style.display = "none";
      document.getElementById("quiz").style.display = "block";
      document.getElementById("quitBtn").style.display = "block";
      show();
    }

    function show() {
      const q = pool[idx];
      document.getElementById("count").innerText = `‡§∏‡§µ‡§æ‡§≤: ${idx+1} / ${pool.length}`;
      document.getElementById("qBox").innerText = q.question;
      
      const expBox = document.getElementById("expBox");
      const showBtn = document.getElementById("showBtn");
      
      expBox.style.display = "none";
      expBox.innerText = q.explanation || "";

      // ‡§Ö‡§ó‡§∞ explanation ‡§π‡•à ‡§§‡•ã ‡§¨‡§ü‡§® ‡§¶‡§ø‡§ñ‡§æ‡§ì, ‡§µ‡§∞‡§®‡§æ ‡§õ‡•Å‡§™‡§æ ‡§¶‡•ã
      if (q.explanation && q.explanation.trim() !== "") {
        showBtn.style.display = "block";
      } else {
        showBtn.style.display = "none";
      }
    }

    function toggleExp() {
      const eb = document.getElementById("expBox");
      eb.style.display = (eb.style.display === "block") ? "none" : "block";
    }

    function next(win) {
      if(win) score++;
      idx++;
      if(idx < pool.length) show();
      else alert(`‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§™‡•Ç‡§∞‡§æ! ‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}/${pool.length}`) || location.reload();
    }

    function toggleTheme() {
      document.body.setAttribute("data-theme", document.body.hasAttribute("data-theme") ? "" : "dark");
    }
  </script>
</body>
</html>
